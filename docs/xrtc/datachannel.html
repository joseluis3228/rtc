<!DOCTYPE html />

<html>
<head>
	<title>DataChannel.js</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<link href="../nocco.css" rel="stylesheet" media="all" type="text/css" />
	<script src="../prettify.js" type="text/javascript"></script>
</head>
<body onload="prettyPrint()">
	<div id="container">
		<div id="background"></div>
			<div id="jump_to">
				Jump To &hellip;
				<div id="jump_wrapper">
					<div id="jump_page">
							<a class="source" href="../xrtc/ajax.html">
								xrtc\Ajax.js
							</a>
							<a class="source" href="../xrtc/authmanager.html">
								xrtc\AuthManager.js
							</a>
							<a class="source" href="../xrtc/class.html">
								xrtc\Class.js
							</a>
							<a class="source" href="../xrtc/common.html">
								xrtc\Common.js
							</a>
							<a class="source" href="../xrtc/commonerror.html">
								xrtc\CommonError.js
							</a>
							<a class="source" href="../xrtc/connection.html">
								xrtc\Connection.js
							</a>
							<a class="source" href="../xrtc/datachannel.html">
								xrtc\DataChannel.js
							</a>
							<a class="source" href="../xrtc/eventdispatcher.html">
								xrtc\EventDispatcher.js
							</a>
							<a class="source" href="../xrtc/handshakecontroller.html">
								xrtc\HandshakeController.js
							</a>
							<a class="source" href="../xrtc/logger.html">
								xrtc\Logger.js
							</a>
							<a class="source" href="../xrtc/room.html">
								xrtc\Room.js
							</a>
							<a class="source" href="../xrtc/serverconnector.html">
								xrtc\ServerConnector.js
							</a>
							<a class="source" href="../xrtc/stream.html">
								xrtc\Stream.js
							</a>
							<a class="source" href="../xrtc/usermedia.html">
								xrtc\UserMedia.js
							</a>
					</div>
				</div>
			</div>
		<table cellpadding="0" cellspacing="0">
			<thead>
				<tr>
					<th class="docs">
						<h1>DataChannel.js</h1>
					</th>
					<th class="code"></th>
				</tr>
			</thead>
			<tbody>
					<tr id="section_1">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_1">&#182;</a>
							</div>
							<h4>Version 1.3.0</h4>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_2">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_2">&#182;</a>
							</div>
							<p><code>xRtc.DataChannel</code> is one of the main objects of <strong>xRtc</strong> library.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
&#39;use strict&#39;;

(function (exports) {
	var xrtc = exports.xRtc;
	
	xrtc.Class(xrtc, &#39;DataChannel&#39;, function (dataChannel, userId) {
		var proxy = xrtc.Class.proxy(this),
			logger = new xrtc.Logger(this.className),
			events = xrtc.DataChannel.events;

		dataChannel.onopen = proxy(channelOnOpen);
		dataChannel.onmessage = proxy(channelOnMessage);
</code></pre>
						</td>
					</tr>
					<tr id="section_3">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_3">&#182;</a>
							</div>
							<p><code>dataChannel.onclose</code> tested in case of disconnect(close browser tab) of remote browser for <em>Chrome M29</em>
<strong>Todo:</strong> Need to test onclose event in case of remote client disconnection for <em>Chrome M25-28</em>.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		dataChannel.onclose = proxy(channelOnClose);
		dataChannel.onerror = proxy(channelOnError);
		dataChannel.ondatachannel = proxy(channelOnDatachannel);

		xrtc.Class.extend(this, xrtc.EventDispatcher, {
			_logger: logger,

</code></pre>
						</td>
					</tr>
					<tr id="section_4">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_4">&#182;</a>
							</div>
							<p><strong>[Public API]:</strong> Sends a message to remote user where <code>mesage</code> is message to send.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>			send: function (message) {
				logger.info(&#39;send&#39;, arguments);

				if (this.getState() === xrtc.DataChannel.states.open) {
					try {
						var messageContainer = { message: message };
						dataChannel.send(JSON.stringify(messageContainer));
						this.trigger(events.sentMessage, messageContainer);
					} catch(ex) {
						var sendingError = new xrtc.CommonError(&#39;onerror&#39;, &#39;DataChannel sending error.&#39;, ex);
						logger.error(&#39;error&#39;, sendingError);
						this.trigger(events.error, sendingError);
					}
				} else {
					var error = new xrtc.CommonError(&#39;onerror&#39;, &#39;DataChannel should be opened before sending.&#39;);
					logger.error(&#39;error&#39;, error);
					this.trigger(events.error, error);
				}
			},

</code></pre>
						</td>
					</tr>
					<tr id="section_5">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_5">&#182;</a>
							</div>
							<p><strong>[Public API]</strong></p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>			getUserId: function() {
				return userId;
			},

</code></pre>
						</td>
					</tr>
					<tr id="section_6">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_6">&#182;</a>
							</div>
							<p><strong>[Public API]</strong></p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>			getName: function() {
				return dataChannel.label;
			},

</code></pre>
						</td>
					</tr>
					<tr id="section_7">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_7">&#182;</a>
							</div>
							<p><strong>[Public API]</strong></p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>			getState: function () {
				/* W3C Editor&#39;s Draft 30 August 2013:
				enum RTCDataChannelState {
					&quot;connecting&quot;,
					&quot;open&quot;,
					&quot;closing&quot;,
					&quot;closed&quot;
				};
				*/

				return dataChannel.readyState.toLowerCase();
			}
		});

		function channelOnOpen(evt) {
			var data = { event: evt };
			logger.debug(&#39;open&#39;, data);
			this.trigger(events.open, data);
		};

		function channelOnMessage(evt) {
			var messageContainer = JSON.parse(evt.data);

			logger.debug(&#39;message&#39;, messageContainer);
			this.trigger(events.receivedMessage, messageContainer);
		}

		function channelOnClose(evt) {
			var data = { event: evt };
			logger.debug(&#39;close&#39;, data);
			this.trigger(events.close, data);
		}

		function channelOnError(evt) {
			var error = new xrtc.CommonError(&#39;onerror&#39;, &#39;DataChannel error.&#39;, evt);
			logger.error(&#39;error&#39;, error);
			this.trigger(events.error, error);
		}

		function channelOnDatachannel(evt) {
			var data = { event: evt };
			logger.debug(&#39;datachannel&#39;, data);
			this.trigger(events.dataChannel, data);
		}
	});

</code></pre>
						</td>
					</tr>
					<tr id="section_8">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_8">&#182;</a>
							</div>
							<p><strong>Note:</strong> Full list of events for the <code>xRtc.DataChannel</code> object.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	xrtc.DataChannel.extend({
		events: {
			open: &#39;open&#39;,
			sentMessage: &#39;sentMessage&#39;,
			receivedMessage: &#39;receivedMessage&#39;,
			close: &#39;close&#39;,
			error: &#39;error&#39;,
			dataChannel: &#39;datachannel&#39;
		},

</code></pre>
						</td>
					</tr>
					<tr id="section_9">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_9">&#182;</a>
							</div>
							<p><strong>Note:</strong> Full list of states of the <code>xRtc.DataChannel</code> object.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		states: {
			connecting: &quot;connecting&quot;,
			open: &quot;open&quot;,
			closing: &quot;closing&quot;,
			closed: &quot;closed&quot;
		}
	});
})(window);
</code></pre>
						</td>
					</tr>
			</tbody>
		</table>
	</div>
</body>
</html>
