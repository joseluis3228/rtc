<!DOCTYPE html />

<html>
<head>
	<title>dataChannel.js</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<link href="../nocco.css" rel="stylesheet" media="all" type="text/css" />
	<script src="../prettify.js" type="text/javascript"></script>
</head>
<body onload="prettyPrint()">
	<div id="container">
		<div id="background"></div>
			<div id="jump_to">
				Jump To &hellip;
				<div id="jump_wrapper">
					<div id="jump_page">
							<a class="source" href="../xrtc/ajax.html">
								xrtc\ajax.js
							</a>
							<a class="source" href="../xrtc/authmanager.html">
								xrtc\authManager.js
							</a>
							<a class="source" href="../xrtc/class.html">
								xrtc\class.js
							</a>
							<a class="source" href="../xrtc/common.html">
								xrtc\common.js
							</a>
							<a class="source" href="../xrtc/commonerror.html">
								xrtc\commonError.js
							</a>
							<a class="source" href="../xrtc/connection.html">
								xrtc\connection.js
							</a>
							<a class="source" href="../xrtc/datachannel.html">
								xrtc\dataChannel.js
							</a>
							<a class="source" href="../xrtc/eventdispatcher.html">
								xrtc\eventDispatcher.js
							</a>
							<a class="source" href="../xrtc/handshakecontroller.html">
								xrtc\handshakeController.js
							</a>
							<a class="source" href="../xrtc/logger.html">
								xrtc\logger.js
							</a>
							<a class="source" href="../xrtc/room.html">
								xrtc\room.js
							</a>
							<a class="source" href="../xrtc/serverconnector.html">
								xrtc\serverConnector.js
							</a>
							<a class="source" href="../xrtc/stream.html">
								xrtc\stream.js
							</a>
							<a class="source" href="../xrtc/usermedia.html">
								xrtc\userMedia.js
							</a>
					</div>
				</div>
			</div>
		<table cellpadding="0" cellspacing="0">
			<thead>
				<tr>
					<th class="docs">
						<h1>dataChannel.js</h1>
					</th>
					<th class="code"></th>
				</tr>
			</thead>
			<tbody>
					<tr id="section_1">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_1">&#182;</a>
							</div>
							<h4>Version 1.5.0</h4>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_2">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_2">&#182;</a>
							</div>
							<p><code>xRtc.DataChannel</code> is one of the main objects of <strong>xRtc</strong> library. This object can be used for trenferring any information to remote side.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_3">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_3">&#182;</a>
							</div>
							<p><strong>Note:</strong> xRtc 1.4.0 supports only <code>text</code> messages. If <code>object</code> will be used then it will be serialized to <code>text</code> (JSON).</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_4">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_4">&#182;</a>
							</div>
							<p><strong>xRtc 1.4.0 restrictions:</strong></p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_5">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_5">&#182;</a>
							</div>
							<ul>
<li>Message should be less then ~1000 symbols.</li>
<li>Interoperablity between <em>FireFox</em> and <em>Chrome</em> doesn't supported.</li>
</ul>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_6">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_6">&#182;</a>
							</div>
							<p><strong>Dependencies:</strong></p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_7">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_7">&#182;</a>
							</div>
							<ul>
<li>class.js;</li>
<li>eventDispatcher.js;</li>
<li>logger.js;</li>
<li>common.js;</li>
<li>commonError.js.</li>
</ul>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
(function (exports) {
	&#39;use strict&#39;;

	if (typeof exports.xRtc === &#39;undefined&#39;) {
		exports.xRtc = {};
	}

	var xrtc = exports.xRtc;

	xrtc.Class(xrtc, &#39;DataChannel&#39;, function (dataChannel, connection) {
		var proxy = xrtc.Class.proxy(this),
			logger = new xrtc.Logger(this.className),
			events = xrtc.DataChannel.events;

		dataChannel.onopen = proxy(channelOnOpen);
		dataChannel.onmessage = proxy(channelOnMessage);
</code></pre>
						</td>
					</tr>
					<tr id="section_8">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_8">&#182;</a>
							</div>
							<p><code>dataChannel.onclose</code> tested in case of disconnect(close browser tab) of remote browser for <em>Chrome M29</em>
<strong>Todo:</strong> Need to test onclose event in case of remote client disconnection for <em>Chrome M25-28</em>.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		dataChannel.onclose = proxy(channelOnClose);
		dataChannel.onerror = proxy(channelOnError);
		dataChannel.ondatachannel = proxy(channelOnDatachannel);

		xrtc.Class.extend(this, xrtc.EventDispatcher, {
			_logger: logger,

</code></pre>
						</td>
					</tr>
					<tr id="section_9">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_9">&#182;</a>
							</div>
							<p><strong>[Public API]:</strong> Returns unique data channel id.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>			getId: function () {
				return connection.getId() + this.getName();
			},

</code></pre>
						</td>
					</tr>
					<tr id="section_10">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_10">&#182;</a>
							</div>
							<p><strong>[Public API]:</strong> Returns remote user for this data channel.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>			getRemoteUser: function () {
				return connection.getRemoteUser();
			},

</code></pre>
						</td>
					</tr>
					<tr id="section_11">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_11">&#182;</a>
							</div>
							<p><strong>[Public API]:</strong> Returns parent connection.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>			getConnection: function () {
				return connection;
			},

</code></pre>
						</td>
					</tr>
					<tr id="section_12">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_12">&#182;</a>
							</div>
							<p><strong>[Public API]:</strong> Returns unique <code>name</code> of the data channel.
This <code>name</code> should be specified on <code>createDataChannel(name)</code> method of <code>xRtc.Connection</code> object.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>			getName: function () {
				return dataChannel.label;
			},

</code></pre>
						</td>
					</tr>
					<tr id="section_13">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_13">&#182;</a>
							</div>
							<p><strong>[Public API]:</strong> Returns the <code>state</code> of the data channel. Full list of states you can see below.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>			getState: function () {
				/* W3C Editor&#39;s Draft 30 August 2013:
				enum RTCDataChannelState {
					&quot;connecting&quot;,
					&quot;open&quot;,
					&quot;closing&quot;,
					&quot;closed&quot;
				};
				*/

				return dataChannel.readyState.toLowerCase();
			},

</code></pre>
						</td>
					</tr>
					<tr id="section_14">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_14">&#182;</a>
							</div>
							<p><strong>[Public API]:</strong> Sends a message to remote user where <code>data</code> is message to send.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_15">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_15">&#182;</a>
							</div>
							<p><strong>Note:</strong> <code>data</code> can be as a <code>string</code>. If you want to send a file then it should be serialized to binary string before.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>			send: function (data) {
				var self = this;
				logger.info(&#39;send&#39;, arguments);

				try {
					xrtc.binarySerializer.pack(
						data,
						function (arrayBuffer) {
							dataChannel.send(arrayBuffer);
						},
					function (evt) {
						var error = new xrtc.CommonError(&#39;onerror&#39;, &#39;DataChannel error.&#39;, evt);
						logger.error(&#39;error&#39;, error);
						self.trigger(events.error, error);
					});
				} catch (ex) {
					var sendingError = new xrtc.CommonError(&#39;onerror&#39;, &#39;DataChannel sending error. Channel state is &quot;&#39; + self.getState() + &#39;&quot;&#39;, ex);
					logger.error(&#39;error&#39;, sendingError);
					self.trigger(events.error, sendingError);
				}

				self.trigger(events.sentMessage, { data: data });
			}
		});

		function channelOnOpen(evt) {
			var data = { event: evt };
			logger.debug(&#39;open&#39;, data);
			this.trigger(events.open, data);
		};

		function channelOnMessage(evt) {
			logger.debug(&#39;message&#39;, evt.data);
			var desrializedMessage = xrtc.binarySerializer.unpack(evt.data);
			logger.debug(&#39;deserialized message&#39;, desrializedMessage);
			this.trigger(events.receivedMessage, { data: desrializedMessage });
		}

		function channelOnClose(evt) {
			var data = { event: evt };
			logger.debug(&#39;close&#39;, data);
			this.trigger(events.close, data);
		}

		function channelOnError(evt) {
			var error = new xrtc.CommonError(&#39;onerror&#39;, &#39;DataChannel error.&#39;, evt);
			logger.error(&#39;error&#39;, error);
			this.trigger(events.error, error);
		}

		function channelOnDatachannel(evt) {
			var data = { event: evt };
			logger.debug(&#39;datachannel&#39;, data);
			this.trigger(events.dataChannel, data);
		}
	});

	xrtc.DataChannel.extend({
</code></pre>
						</td>
					</tr>
					<tr id="section_16">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_16">&#182;</a>
							</div>
							<p><strong>Note:</strong> Full list of events for the <code>xRtc.DataChannel</code> object.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		events: {
			open: &#39;open&#39;,
			sentMessage: &#39;sentMessage&#39;,
			receivedMessage: &#39;receivedMessage&#39;,
			close: &#39;close&#39;,
			error: &#39;error&#39;,
			dataChannel: &#39;datachannel&#39;
		},

</code></pre>
						</td>
					</tr>
					<tr id="section_17">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_17">&#182;</a>
							</div>
							<p><strong>Note:</strong> Full list of states of the <code>xRtc.DataChannel</code> object.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		states: {
			connecting: &quot;connecting&quot;,
			open: &quot;open&quot;,
			closing: &quot;closing&quot;,
			closed: &quot;closed&quot;
		}
	});
})(window);
</code></pre>
						</td>
					</tr>
			</tbody>
		</table>
	</div>
</body>
</html>
